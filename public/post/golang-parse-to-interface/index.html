<!DOCTYPE html>
<html ⚡>
  <head>
    <meta charset="utf-8">
<meta name="pinterest" content="nopin">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<meta name="theme-color" content="#263238">

<meta name="generator" content="Hugo 0.19-DEV" />

<link rel="apple-touch-icon" href="http://example.org/images/logo.png">


<link rel="canonical" href="http://example.org/post/golang-parse-to-interface/">


    
    <link href="https://fonts.googleapis.com/css?family=Lobster|Lato:400,700" rel="stylesheet">
    
    <title>Golang Parsing JSON into Interfaces - My New Hugo Site</title>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
    
    
    
<meta name="description" content="Using interface types when unmarshalling JSON Interfaces are an incredibly powerful feature in Go, and JSON is one of the most ubiquitous serialization formats in use today. If you’re reasonably new to Go you may not have tried to mash the two together yet, but if you have, you may have seen an error that looks like json: cannot unmarshal string into Go value of type Foo. Clearly the Go creators must have given us a way to leverage interfaces when unmarshalling JSON!">

<meta property="og:title" content="Golang Parsing JSON into Interfaces - My New Hugo Site">
<meta property="og:type" content="article">
<meta property="og:url" content="http://example.org/post/golang-parse-to-interface/">
<meta property="og:image" content="http://example.org/images/default.png">
<meta property="og:site_name" content="My New Hugo Site">
<meta property="og:description" content="Using interface types when unmarshalling JSON Interfaces are an incredibly powerful feature in Go, and JSON is one of the most ubiquitous serialization formats in use today. If you’re reasonably new to Go you may not have tried to mash the two together yet, but if you have, you may have seen an error that looks like json: cannot unmarshal string into Go value of type Foo. Clearly the Go creators must have given us a way to leverage interfaces when unmarshalling JSON!">
<meta property="og:locale" content="ja_JP">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="My New Hugo Site">
<meta name="twitter:url" content="http://example.org/post/golang-parse-to-interface/">
<meta name="twitter:title" content="Golang Parsing JSON into Interfaces - My New Hugo Site">
<meta name="twitter:description" content="Using interface types when unmarshalling JSON Interfaces are an incredibly powerful feature in Go, and JSON is one of the most ubiquitous serialization formats in use today. If you’re reasonably new to Go you may not have tried to mash the two together yet, but if you have, you may have seen an error that looks like json: cannot unmarshal string into Go value of type Foo. Clearly the Go creators must have given us a way to leverage interfaces when unmarshalling JSON!">
<meta name="twitter:image" content="http://example.org/images/default.png">


<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "NewsArticle",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id":"http:\/\/example.org\/"
    },
    "headline": "Golang Parsing JSON into Interfaces - My New Hugo Site",
    "image": {
      "@type": "ImageObject",
      "url": "http:\/\/example.org\/images\/default.png",
      "height": 800,
      "width": 800
    },
    "datePublished": "2015-11-13T21:31:40JST",
    "dateModified": "2015-11-13T21:31:40JST",
    "author": {
      "@type": "Person",
      "name": "My New Hugo Site"
    },
    "publisher": {
      "@type": "Organization",
      "name": "My New Hugo Site",
      "logo": {
        "@type": "ImageObject",
        "url": "http:\/\/example.org\/images/logo.png",
        "width": 600,
        "height": 60
      }
    },
    "description": "Using interface types when unmarshalling JSON Interfaces are an incredibly powerful feature in Go, and JSON is one of the most ubiquitous serialization formats in use today. If you’re reasonably new to Go you may not have tried to mash the two together yet, but if you have, you may have seen an error that looks like json: cannot unmarshal string into Go value of type Foo. Clearly the Go creators must have given us a way to leverage interfaces when unmarshalling JSON!"
  }
</script>


    <style amp-custom>
      html { font-size: 18px;}@media (max-width: 768px) { html { font-size: 15px; }}body { font-family: Lato,'Hiragino Kaku Gothic Pro',メイリオ,Meiryo,sans-serif; font-size: inherit; margin: 0; color: #263238;}html, body { margin: 0;}a { text-decoration: none; color: #e91e63;}p { margin: 0;}ul,ol { margin: 0; padding: 0;}h1, h2, h3, h4, h5, h6 { margin: 0; font-weight: 700;}h1 { font-size: 1.8rem; line-height: 2rem; margin: 1.5rem 0; }h2 { font-size: 1.4rem; line-height: 2rem; margin: 1.5rem 0; }h3 { font-size: 1.2rem; line-height: 1.5rem; margin: 1.5rem 0; }h4, h5, h6 { font-size: 1rem; line-height: 1.5rem; margin: 1.5rem 0; }.clearfix::after { content: ''; display: block; clear: both;}main { display: block;}/* Layouts */.l-header { padding: .5rem 0; margin-bottom: 2rem; border-bottom: 1px dashed #cfd8dc; text-align: center;}.l-footer { font-size: .8rem; padding: 1rem 0; border-top: 1px dashed #cfd8dc;}.l-container { max-width: 42rem; margin: 0 auto; padding: 0 1rem;}/* Parts:logo */.p-logo { font-family: Lobster, cursive;}.p-logo a { color: #000; font-size: 1.6rem; line-height: 2rem;}/* Parts:section */section { border-top: 2px solid #eceff1; padding: 1.5rem 0;}section>header { text-transform: uppercase; font-weight: 700; margin-bottom: 2rem; text-align: center;}section>header span { display: inline-block; background-color: #000; color: #fff; letter-spacing: 3px; font-size: .7rem; padding: .5rem .75rem;}/* Parts:facts */.p-facts { list-style: none; font-size: .8rem; margin-bottom: 1rem;}.p-facts:last-child { margin-bottom: 0;}.p-facts li { display: inline-block; margin-right: .5rem; text-transform: uppercase;}.p-facts li header { margin-bottom: .25rem; font-weight: 700;}.p-facts li header a { color: #000; text-decoration: underline;}.p-facts li li { display: inline-block; margin-right: .5rem;}.p-facts li li::after { content: ',';}.p-facts li li:last-child::after { content: '';}/* Parts:crumb */.p-crumb { list-style: none; margin-bottom: 1rem; font-size: .8rem; text-transform: uppercase; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}.p-crumb:last-child { margin-bottom: 0;}.p-crumb li { display: inline;}.p-crumb li::after { content: '›'; margin: 0 .5rem;}.p-crumb li:last-child::after { content: '';}/* Parts:page-title */.p-page-title { margin-bottom: 2rem;}.p-page-title .title { margin-bottom: .5rem;}/* Parts:share */.p-share { margin-bottom: 1.5rem;}.p-share a { display: inline-block; text-align: center; padding: .5rem .5rem; margin-right: .25rem; font-size: .6rem; background-color: #eceff1; font-weight: 700k}.p-share a.ht { color: #00a4de; }.p-share a.fb { color: #3b5998; }.p-share a.tw { color: #1da1f2; }.p-share a.gp { color: #dd4b39; }.p-share a.ln { color: #00c300; }.p-share a.ht::before { content: 'Hatena'; }.p-share a.fb::before { content: 'Facebook'; }.p-share a.tw::before { content: 'Twitter'; }.p-share a.gp::before { content: 'Google+'; }.p-share a.ln::before { content: 'LINE'; }/* Parts:terms */.p-terms { padding-left: 2rem;}/* Parts:article */.p-articles { list-style: none;}.p-articles>li { margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px dashed #cfd8dc;}.p-articles>li:last-child { border-bottom: none; padding-bottom: 0;}.p-articles.thin>li { margin-bottom: 1rem; padding-bottom: 1rem;}article .article-header { display: table-cell; height: 6rem; vertical-align: middle;}article .title { margin: 0; margin-bottom: .5rem; font-size: 1.4rem; line-height: 2rem;}article .title a { color: #000;}article .header-wrapper { margin-bottom: 1.5rem;}article .thumbnail { display: block; background-position: center; background-size: cover; background-image: url(http://example.org/images/default.jpg); width: 6rem; height: 6rem; border-radius: 50%; box-shadow: 0 0 3px 0 #333 inset; float: left; margin-right: 1rem;}article .summary { margin-bottom: 1.5rem;}article .readmore { text-align: center;}article .readmore a { font-size: .8rem; color: #000; text-decoration: underline;}article.li.sm .header-wrapper { margin-bottom: 0;}.article-body h2 { padding: 1rem 0; border-bottom: 2px solid #eceff1;}.article-body h2:first-child { margin-top: 0; }.article-body h3 { color: #cddc39;}.article-body h4 { border-left: solid .25rem #cddc39; padding: 0 .5rem;}.article-body p { margin: 1.5rem 0; line-height: 1.5rem;}.article-body a { text-decoration: underline;}.article-body ul,.article-body ol { padding-left: 1.5rem;}.article-body code { display: inline-block; font-family: Menlo, consolas, monospace; background-color: #eceff1; font-size: .8rem; padding: 0 .5rem; line-height: 1.5rem;}.article-body pre { margin: 1.5rem 0; padding: 1.5rem; font-size: .8rem; background-color: #263238; color: #fff; overflow: auto;}.article-body pre code { background-color: transparent;}.article-body blockquote { margin: 1.5rem 0; padding: .5rem 0; font-size: .8rem; border-top: 1px solid #eceff1; border-bottom: 1px solid #eceff1; color: #607d8b;}.article-body blockquote p { margin: .5rem 0; line-height: 1rem;}.article-body strong { box-shadow: 0 -.5rem 0 0 #f06292 inset;}.article-body em { font-style: normal; font-weight: 700; color: #ff5722;}.article-body figure { margin: 1.5rem -2rem; }.article-body figure.left,.article-body figure.right { width: 15rem; height: 12rem; margin-top: 0; margin-left: 0; margin-right: 0;}.article-body figure.left { float: left; margin-right: 1rem; margin-left: -2rem; }.article-body figure.right { float: right; margin-left: 1rem; margin-right: -2rem; }@media (max-width: 768px) { .article-body figure { margin: 1.5rem -1rem; } .article-body figure.left, .article-body figure.right { float: none; margin: 0 -1rem; width: auto; height: auto; }}.article-body figcaption { padding: .5rem 0; font-size: .8rem; text-align: center;}.article-body figcaption a { color: #263238;}

      
    </style>
  </head>

  <body>
    
    
    

    <header class="l-header">
      <div class="l-container">
        <div class="h-logo p-logo">
          <a href="http://example.org/" class="h-logo">My New Hugo Site</a>
        </div>
      </div>
    </header>

    <main>
      
<div class="l-container">
  <article class="single article-8cfa3c90064f361fea2732fd9b8e9bd8">
  <div class="header-wrapper">
    <a href="http://example.org/post/golang-parse-to-interface/" class="thumbnail" title="Golang Parsing JSON into Interfaces"></a>
    <header class="article-header">
      <div class="clearfix">
        <h1 class="title">Golang Parsing JSON into Interfaces</h1>
        <ul class="p-facts">
          <li><time datetime="2015-11-13T21:31:40JST">Nov 13, 2015</time></li>
          <li><a href="http://example.org/post/">post</a></li>
          
        </ul>
      </div>
    </header>
  </div>

  <aside class="p-share">
  <a href="http://b.hatena.ne.jp/add?mode=confirm&url=http%3a%2f%2fexample.org%2fpost%2fgolang-parse-to-interface%2f&title=Golang%20Parsing%20JSON%20into%20Interfaces" title="はてなブックマーク" class="ht" target="_blank" rel="nofollow"></a>
  <a href="http://www.facebook.com/sharer.php?u=http%3a%2f%2fexample.org%2fpost%2fgolang-parse-to-interface%2f&t=Golang%20Parsing%20JSON%20into%20Interfaces" title="Facebookでシェア" class="fb" target="_blank" rel="nofollow"></a>
  <a href="http://twitter.com/intent/tweet?url=http%3a%2f%2fexample.org%2fpost%2fgolang-parse-to-interface%2f&text=Golang%20Parsing%20JSON%20into%20Interfaces&tw_p=tweetbutton" title="Twitterでシェア" class="tw" target="_blank" rel="nofollow"></a>
  <a href="https://plus.google.com/share?url=http%3a%2f%2fexample.org%2fpost%2fgolang-parse-to-interface%2f" title="Google Plusでシェア" class="gp" target="_blank" rel="nofollow"></a>
  <a href="http://line.me/R/msg/text/?Golang%20Parsing%20JSON%20into%20Interfaces http%3a%2f%2fexample.org%2fpost%2fgolang-parse-to-interface%2f" title="LINEでシェア" class="ln" target="_blank" rel="nofollow"></a>
</aside>


  <div class="article-body">

<h2 id="using-interface-types-when-unmarshalling-json">Using interface types when unmarshalling JSON</h2>

<p>Interfaces are an incredibly powerful feature in Go, and JSON is one of the
most ubiquitous serialization formats in use today. If you’re reasonably
new to Go you may not have tried to mash the two together yet, but if you
have, you may have seen an error that looks like <code>json: cannot unmarshal string
into Go value of type Foo</code>. Clearly the Go creators must have given us a way
to leverage interfaces when unmarshalling JSON!</p>

<p>We’re going to use the following short sample code to illustrate how to achieve this magic:</p>

<pre><code>package main

import (
	&quot;encoding/json&quot;
	&quot;fmt&quot;
	&quot;math&quot;
)

type Shape interface {
	Name() string
	Area() float64
	Circumference() float64
}

type Square struct {
	Size int `json:&quot;size&quot;`
}

func (s Square) Name() string {
	return &quot;square&quot;
}

func (s Square) Area() float64 {
	return float64(s.Size * s.Size)
}

func (s Square) Circumference() float64 {
	return float64(4 * s.Size)
}

type Circle struct {
	Radius int `json:&quot;radius&quot;`
}

func (c Circle) Name() string {
	return &quot;circle&quot;
}

func (c Circle) Area() float64 {
	return math.Pi * float64(c.Radius*c.Radius)
}

func (c Circle) Circumference() float64 {
	return math.Pi * float64(c.Radius*2)
}

type Scene struct {
	Shapes map[string]Shape `json:&quot;shapes&quot;`
}

func main() {
	data := []byte(`{&quot;shapes&quot;:{
		&quot;square&quot;: {
			&quot;size&quot;: 2
		},
		&quot;circle&quot;: {
			&quot;radius&quot;: 1
		}
	}}`)
	s := Scene{}
	err := json.Unmarshal(data, &amp;s)
	if err != nil {
		fmt.Println(err)
		return
	}
	fmt.Println(s.Shapes)
}
</code></pre>

<p>Hopefully it’s reasonably clear why it’s impossible to unmarshal into an
interface. Interfaces have no fields and no concrete underlying data structure
into which to unmarshal the JSON. They are simply a definition of behaviour
(a collection of methods) required to satisfy a particular use case. So how
would we go about using the power and flexibility of interfaces during JSON
unmarshalling?</p>

<p>If you’ve poked around the <code>encoding/json</code> package, you may have noticed it has
an interface of its own that looks interesting. It’s the <code>Unmarshaller</code>. This
interface provides a way for structs to define their own unmarshalling logic.
Still we run into the problem that interfaces are not concrete, so our
interface cannot possibly implement <code>Unmarshaller</code> itself.</p>

<p>However, if we hoist the concept up one level, what if we define a type for
our Scene.Shapes map. It might look like:</p>

<pre><code>type ShapeMap map[string]Shape

type Scene struct {
	Shapes ShapeMap `json:&quot;shapes&quot;`
}
</code></pre>

<p>Simple right? Also not quite enough yet. All we’ve done so far is create
another layer of indirection but we’re still, at the end of the day,
attempting to unmarshal JSON into an interface. So what about that
<code>Unmarshaller</code> interface? The <code>encoding/json</code> library detects if a struct
implements the interface and will automatically delegate unmarshalling,
so what would our <code>UnmarshalJSON</code> function for <code>ShapeMap</code> look like? Let’s
take a look:</p>

<pre><code>type ShapeMap map[string]Shape

func (sm *ShapeMap) UnmarshalJSON(data []byte) error {
	shapes := make(map[string]json.RawMessage)
	err := json.Unmarshal(data, &amp;shapes)
	if err != nil {
		return err
	}
	result := make(ShapeMap)
	for k, v := range shapes {
		switch k {
		case &quot;square&quot;:
			s := Square{}
			err := json.Unmarshal(v, &amp;s)
			if err != nil {
				return err
			}
			result[k] = s
		case &quot;circle&quot;:
			c := Circle{}
			err := json.Unmarshal(v, &amp;c)
			if err != nil {
				return err
			}
			result[k] = c
		default:
			return errors.New(&quot;Unrecognized shape&quot;)
		}
	}
	*sm = result
	return nil
}
</code></pre>

<p>Within our <code>UnmarshalJSON</code> we partially unmarshal the map making use of
<code>json.RawMessage</code> to leave the data associated with a shape in serialized form
until we know what type of shape it is by inspection of the map keys. We loop
over this partially unmarshalled map, and unmarshal each shape into the
appropriate struct based on the value of the key. Finally, the line
<code>*sm = result</code> is something we don’t see a lot of Go, there’s rarely call
for it. Here we are dereferencing the pointer to the receiver struct and
assigning the value of the result map to it. This gives the receiver the value
of result in its entirety. If the receiver already contained some state, it
would get replaced.</p>

<p>Providing a full final example, this now allows us to unmarshal JSON into an
interface type via a little indirection and use of a couple of handy
<code>encoding/json</code> features, the <code>Unmarshaller</code> interface, and <code>RawMessage</code>.</p>

<pre><code>package main

import (
	&quot;encoding/json&quot;
	&quot;errors&quot;
	&quot;fmt&quot;
	&quot;math&quot;
)

type Shape interface {
	Name() string
	Area() float64
	Circumference() float64
}

type Square struct {
	Size int `json:&quot;size&quot;`
}

func (s Square) Name() string {
	return &quot;square&quot;
}

func (s Square) Area() float64 {
	return float64(s.Size * s.Size)
}

func (s Square) Circumference() float64 {
	return float64(4 * s.Size)
}

type Circle struct {
	Radius int `json:&quot;radius&quot;`
}

func (c Circle) Name() string {
	return &quot;circle&quot;
}

func (c Circle) Area() float64 {
	return math.Pi * float64(c.Radius*c.Radius)
}

func (c Circle) Circumference() float64 {
	return math.Pi * float64(c.Radius*2)
}

type ShapeMap map[string]Shape

func (sm *ShapeMap) UnmarshalJSON(data []byte) error {
	shapes := make(map[string]json.RawMessage)
	err := json.Unmarshal(data, &amp;shapes)
	if err != nil {
		return err
	}
	result := make(ShapeMap)
	for k, v := range shapes {
		switch k {
		case &quot;square&quot;:
			s := Square{}
			err := json.Unmarshal(v, &amp;s)
			if err != nil {
				return err
			}
			result[k] = s
		case &quot;circle&quot;:
			c := Circle{}
			err := json.Unmarshal(v, &amp;c)
			if err != nil {
				return err
			}
			result[k] = c
		default:
			return errors.New(&quot;Unrecognized shape&quot;)
		}
	}
	*sm = result
	return nil
}

type Scene struct {
	Shapes ShapeMap `json:&quot;shapes&quot;`
}

func main() {
	data := []byte(`{&quot;shapes&quot;:{
		&quot;square&quot;: {
			&quot;size&quot;: 2
		},
		&quot;circle&quot;: {
			&quot;radius&quot;: 1
		}
	}}`)
	s := Scene{}
	err := json.Unmarshal(data, &amp;s)
	if err != nil {
		fmt.Println(err)
		return
	}
	fmt.Println(s.Shapes)
}
</code></pre>
</div>

  <aside class="p-share">
  <a href="http://b.hatena.ne.jp/add?mode=confirm&url=http%3a%2f%2fexample.org%2fpost%2fgolang-parse-to-interface%2f&title=Golang%20Parsing%20JSON%20into%20Interfaces" title="はてなブックマーク" class="ht" target="_blank" rel="nofollow"></a>
  <a href="http://www.facebook.com/sharer.php?u=http%3a%2f%2fexample.org%2fpost%2fgolang-parse-to-interface%2f&t=Golang%20Parsing%20JSON%20into%20Interfaces" title="Facebookでシェア" class="fb" target="_blank" rel="nofollow"></a>
  <a href="http://twitter.com/intent/tweet?url=http%3a%2f%2fexample.org%2fpost%2fgolang-parse-to-interface%2f&text=Golang%20Parsing%20JSON%20into%20Interfaces&tw_p=tweetbutton" title="Twitterでシェア" class="tw" target="_blank" rel="nofollow"></a>
  <a href="https://plus.google.com/share?url=http%3a%2f%2fexample.org%2fpost%2fgolang-parse-to-interface%2f" title="Google Plusでシェア" class="gp" target="_blank" rel="nofollow"></a>
  <a href="http://line.me/R/msg/text/?Golang%20Parsing%20JSON%20into%20Interfaces http%3a%2f%2fexample.org%2fpost%2fgolang-parse-to-interface%2f" title="LINEでシェア" class="ln" target="_blank" rel="nofollow"></a>
</aside>


  <footer class="article-footer">
    <section>
      <ol class="p-crumb">
        <li><a href="http://example.org/">My New Hugo Site</a></li>
        
        <li itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="http://example.org/post/" itemprop="url"><span itemprop="title">post</span></a></li>
        
        <li>Golang Parsing JSON into Interfaces</li>
      </ol>

      
      
      
      
      
      
    </section>
  </footer>
</article>



  
  
  <section>
    <header><span>Latests</span></header>
    <ul class="p-articles thin">
      <li><article class="li sm article-d41d8cd98f00b204e9800998ecf8427e">
  <div class="header-wrapper">
    <a href="http://example.org/" class="thumbnail" title="My New Hugo Site"></a>
    <header class="article-header">
      <div class="clearfix">
        <h2 class="title"><a href="http://example.org/">My New Hugo Site</a></h2>
        <ul class="p-facts">
          <li><time datetime="2015-11-13T21:31:40JST">Nov 13, 2015</time></li>
          
          
        </ul>
      </div>
    </header>
  </div>
</article>
</li><li><article class="li sm article-d41d8cd98f00b204e9800998ecf8427e">
  <div class="header-wrapper">
    <a href="http://example.org/post/" class="thumbnail" title="Posts"></a>
    <header class="article-header">
      <div class="clearfix">
        <h2 class="title"><a href="http://example.org/post/">Posts</a></h2>
        <ul class="p-facts">
          <li><time datetime="2015-11-13T21:31:40JST">Nov 13, 2015</time></li>
          
          
        </ul>
      </div>
    </header>
  </div>
</article>
</li>
    </ul>
  </section>
  
</div>


    </main>

    

    <footer class="l-footer">
      <div class="l-container">
        <p><span class="h-logo">&copy; My New Hugo Site</span></p>
        <aside>
          <p>Powered by <a href="https://gohugo.io/">Hugo</a>.</p>
          <p><a href="https://github.com/dim0627/hugo_theme_aglaus" class="h-logo">Aglaus</a> designed by <a href="http://yet.unresolved.xyz/">Daisuke Tsuji</a>.</p>
        </aside>
      </div>
    </footer>

    <a href="#" class="p-movetop" title="ページ上部へ戻る" rel="nofollow"></a>
  </body>
</html>

